<!--pages/user-profile/user-profile.wxml-->
<!-- ä»–äººä¸»é¡µ - Requirements: 2.1, 6.2 -->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:elif="{{errorMessage && !profile}}">
    <text class="error-icon">ğŸ˜•</text>
    <text class="error-text">{{errorMessage}}</text>
    <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
  </view>

  <block wx:elif="{{profile}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="profile-header">
      <view class="profile-top">
        <image 
          src="{{profile.avatar_url || '/assets/images/default-avatar.png'}}" 
          class="profile-avatar"
          mode="aspectFill"
        />
        <view class="profile-info">
          <view class="profile-name-row">
            <text class="profile-name">{{profile.nickname}}</text>
            <text class="mutual-badge" wx:if="{{profile.is_mutual_follow}}">äº’ç›¸å…³æ³¨</text>
          </view>
          <text class="profile-bio">{{profile.bio || 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™'}}</text>
          <text class="profile-location" wx:if="{{profile.location}}">ğŸ“ {{profile.location}}</text>
        </view>
      </view>

      <!-- å…³æ³¨æŒ‰é’® -->
      <button 
        class="follow-btn {{profile.is_following ? 'following' : ''}}" 
        bindtap="onFollow"
        disabled="{{followLoading}}"
      >
        <text wx:if="{{followLoading}}">...</text>
        <text wx:elif="{{profile.is_following}}">å·²å…³æ³¨</text>
        <text wx:else>+ å…³æ³¨</text>
      </button>

      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-row">
        <view class="stat-item" bindtap="onViewFollowing">
          <text class="stat-value">{{profile.following_count || 0}}</text>
          <text class="stat-label">å…³æ³¨</text>
        </view>
        <view class="stat-item" bindtap="onViewFollowers">
          <text class="stat-value">{{profile.follower_count || 0}}</text>
          <text class="stat-label">ç²‰ä¸</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{profile.card_count || 0}}</text>
          <text class="stat-label">å¡ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- å¡ç‰‡åˆ—è¡¨åŒºåŸŸ -->
    <view class="cards-section">
      <view class="section-header">
        <text class="section-title">TA çš„å¡ç‰‡</text>
        <text class="section-count" wx:if="{{profile.card_count > 0}}">å…± {{profile.card_count}} å¼ </text>
      </view>

      <!-- å¡ç‰‡ç½‘æ ¼ -->
      <view class="card-grid" wx:if="{{cards.length > 0}}">
        <view 
          class="card-item" 
          wx:for="{{cards}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onCardTap"
        >
          <image 
            src="{{item.media[0].thumbnail_url || item.media[0].url || '/assets/images/card-placeholder.png'}}" 
            class="card-image" 
            mode="aspectFill"
            wx:if="{{item.media && item.media.length > 0}}"
          />
          <view class="card-placeholder" wx:else>
            <text class="placeholder-icon">ğŸ“·</text>
          </view>
          <view class="card-overlay">
            <text class="card-title">{{item.title}}</text>
            <view class="card-stats">
              <text class="card-stat">â¤ï¸ {{item.like_count || 0}}</text>
              <text class="card-stat">ğŸ’¬ {{item.comment_count || 0}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:elif="{{!loadingCards}}">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-text">æš‚æ— å…¬å¼€å¡ç‰‡</text>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{loadingCards}}">
        <view class="loading-spinner small"></view>
        <text class="load-more-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:elif="{{cards.length > 0 && !hasMoreCards}}">
        <text class="no-more-text">â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
      </view>
    </view>
  </block>
</view>

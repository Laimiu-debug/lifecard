<!--
  媒体选择器组件
  支持图片/视频选择和预览
  Requirements: 3.4
-->
<view class="media-picker {{disabled ? 'media-picker--disabled' : ''}}">
  <!-- 媒体列表 -->
  <view class="media-picker__list">
    <!-- 已选媒体项 -->
    <view 
      wx:for="{{internalMediaList}}" 
      wx:key="id" 
      class="media-picker__item"
      data-index="{{index}}"
      bind:tap="onPreviewMedia"
    >
      <!-- 图片预览 -->
      <block wx:if="{{item.type === 'image'}}">
        <van-image
          width="100%"
          height="100%"
          fit="cover"
          src="{{item.url || item.path}}"
          lazy-load
        />
      </block>

      <!-- 视频预览 -->
      <block wx:elif="{{item.type === 'video'}}">
        <view class="media-picker__video">
          <van-image
            wx:if="{{item.thumbPath}}"
            width="100%"
            height="100%"
            fit="cover"
            src="{{item.thumbPath}}"
          />
          <view wx:else class="media-picker__video-placeholder">
            <van-icon name="video-o" size="48rpx" color="#999" />
          </view>
          <!-- 视频播放图标 -->
          <view class="media-picker__video-play">
            <van-icon name="play-circle-o" size="64rpx" color="#fff" />
          </view>
          <!-- 视频时长 -->
          <view wx:if="{{item.duration}}" class="media-picker__video-duration">
            {{item.duration < 60 ? '0:' + (item.duration < 10 ? '0' : '') + item.duration : Math.floor(item.duration / 60) + ':' + (item.duration % 60 < 10 ? '0' : '') + item.duration % 60}}
          </view>
        </view>
      </block>

      <!-- 上传进度 -->
      <view wx:if="{{item.uploading && showProgress}}" class="media-picker__progress">
        <van-loading size="40rpx" color="#fff" />
        <text class="media-picker__progress-text">{{item.uploadProgress || 0}}%</text>
      </view>

      <!-- 上传错误 -->
      <view wx:if="{{item.uploadError}}" class="media-picker__error" catch:tap="onRetryUpload" data-index="{{index}}">
        <van-icon name="warning-o" size="40rpx" color="#ff4d4f" />
        <text class="media-picker__error-text">点击重试</text>
      </view>

      <!-- 已上传标记 -->
      <view wx:if="{{item.uploaded && !item.uploading}}" class="media-picker__uploaded">
        <van-icon name="success" size="32rpx" color="#52c41a" />
      </view>

      <!-- 删除按钮 -->
      <view 
        wx:if="{{!disabled && !item.uploading}}" 
        class="media-picker__delete" 
        catch:tap="onDeleteMedia" 
        data-index="{{index}}"
      >
        <van-icon name="cross" size="24rpx" color="#fff" />
      </view>
    </view>

    <!-- 添加按钮 -->
    <view 
      wx:if="{{!disabled && (imageCount < maxImageCount || videoCount < maxVideoCount)}}"
      class="media-picker__add"
      bind:tap="onChooseMedia"
    >
      <van-icon name="plus" size="48rpx" color="#999" />
      <text class="media-picker__add-text">
        <block wx:if="{{mediaType === 'image'}}">添加图片</block>
        <block wx:elif="{{mediaType === 'video'}}">添加视频</block>
        <block wx:else>添加媒体</block>
      </text>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="media-picker__tips">
    <text wx:if="{{mediaType === 'image' || mediaType === 'both'}}">
      图片 {{imageCount}}/{{maxImageCount}}
    </text>
    <text wx:if="{{mediaType === 'both'}}"> | </text>
    <text wx:if="{{mediaType === 'video' || mediaType === 'both'}}">
      视频 {{videoCount}}/{{maxVideoCount}}
    </text>
  </view>
</view>

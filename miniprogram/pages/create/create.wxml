<!--
  åˆ›å»ºå¡ç‰‡é¡µé¢
  Requirements: 3.1, 3.2
-->
<view class="page-container">
  <!-- å¡ç‰‡ç±»å‹é€‰æ‹© -->
  <view class="section type-section">
    <view class="section-header">
      <view class="section-title">é€‰æ‹©å¡ç‰‡ç±»å‹ <text class="required">*</text></view>
      <text class="section-hint">é€‰æ‹©æœ€é€‚åˆä½ ä½“éªŒçš„ç±»å‹</text>
    </view>
    <view class="type-grid">
      <view 
        wx:for="{{cardTypes}}" 
        wx:key="type"
        class="type-item {{cardType === item.type ? 'active' : ''}}"
        data-type="{{item.type}}"
        bindtap="onTypeSelect"
      >
        <view class="type-icon-wrapper">
          <text class="type-icon">{{item.icon}}</text>
        </view>
        <view class="type-info">
          <text class="type-name">{{item.name}}</text>
          <text class="type-desc">{{item.description}}</text>
        </view>
        <view wx:if="{{cardType === item.type}}" class="type-check">
          <van-icon name="success" size="32rpx" color="#1890ff" />
        </view>
      </view>
    </view>
    <view wx:if="{{errors.cardType}}" class="error-message">
      <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
      <text class="error-text">{{errors.cardType}}</text>
    </view>
  </view>

  <!-- æ ‡é¢˜è¾“å…¥ -->
  <view class="section title-section">
    <view class="section-header">
      <view class="section-title">æ ‡é¢˜ <text class="required">*</text></view>
    </view>
    <view class="input-wrapper {{errors.title ? 'has-error' : ''}}">
      <input 
        class="input"
        placeholder="ç»™ä½ çš„ä½“éªŒèµ·ä¸ªæ ‡é¢˜å§"
        placeholder-class="input-placeholder"
        maxlength="200"
        value="{{title}}"
        bindinput="onTitleInput"
      />
    </view>
    <view class="input-footer">
      <view wx:if="{{errors.title}}" class="error-message">
        <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
        <text class="error-text">{{errors.title}}</text>
      </view>
      <text class="char-count {{title.length > 180 ? 'warning' : ''}}">{{title.length}}/200</text>
    </view>
  </view>

  <!-- æè¿°è¾“å…¥ -->
  <view class="section description-section">
    <view class="section-header">
      <view class="section-title">æè¿° <text class="required">*</text></view>
    </view>
    <view class="textarea-wrapper {{errors.description ? 'has-error' : ''}}">
      <textarea 
        class="textarea"
        placeholder="è¯¦ç»†æè¿°ä½ çš„ä½“éªŒï¼Œè®©æ›´å¤šäººäº†è§£..."
        placeholder-class="input-placeholder"
        value="{{description}}"
        bindinput="onDescriptionInput"
        auto-height
        maxlength="-1"
      />
    </view>
    <view wx:if="{{errors.description}}" class="error-message">
      <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
      <text class="error-text">{{errors.description}}</text>
    </view>
  </view>

  <!-- åª’ä½“é€‰æ‹© -->
  <view class="section media-section">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="photo-o" size="32rpx" color="#1890ff" />
        <text class="title-text">æ·»åŠ å›¾ç‰‡/è§†é¢‘</text>
      </view>
      <text class="section-hint">æœ€å¤š9å¼ å›¾ç‰‡æˆ–1ä¸ªè§†é¢‘</text>
    </view>
    <media-picker
      media-list="{{media}}"
      max-image-count="{{9}}"
      max-video-count="{{1}}"
      media-type="both"
      bind:change="onMediaChange"
    />
    <view wx:if="{{errors.media}}" class="error-message">
      <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
      <text class="error-text">{{errors.media}}</text>
    </view>
  </view>

  <!-- ä½ç½®é€‰æ‹© -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="location-o" size="32rpx" color="#1890ff" />
        <text class="title-text">æ·»åŠ ä½ç½®</text>
      </view>
    </view>
    <location-picker
      location="{{location}}"
      placeholder="ç‚¹å‡»æ·»åŠ ä½ç½®"
      show-current-location="{{true}}"
      bind:change="onLocationChange"
    />
  </view>

  <!-- æƒ…ç»ªæ ‡ç­¾ -->
  <view class="section emotion-section">
    <view class="section-header">
      <view class="section-title">
        <text class="emoji-icon">ğŸ˜Š</text>
        <text class="title-text">æƒ…ç»ªæ ‡ç­¾</text>
      </view>
      <text class="section-hint">æœ€å¤š10ä¸ª</text>
    </view>
    <tag-selector
      tags="{{emotionTags}}"
      selected="{{selectedEmotionTags}}"
      max-count="{{10}}"
      tag-type="emotion"
      allow-custom="{{true}}"
      bind:change="onEmotionTagsChange"
    />
    <view wx:if="{{errors.emotionTags}}" class="error-message">
      <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
      <text class="error-text">{{errors.emotionTags}}</text>
    </view>
  </view>

  <!-- å…´è¶£æ ‡ç­¾ -->
  <view class="section interest-section">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="label-o" size="32rpx" color="#1890ff" />
        <text class="title-text">å…´è¶£æ ‡ç­¾</text>
      </view>
      <text class="section-hint">æœ€å¤š10ä¸ª</text>
    </view>
    <tag-selector
      tags="{{interestTags}}"
      selected="{{selectedInterestTags}}"
      max-count="{{10}}"
      tag-type="interest"
      allow-custom="{{true}}"
      bind:change="onInterestTagsChange"
    />
    <view wx:if="{{errors.interestTags}}" class="error-message">
      <van-icon name="warning-o" size="24rpx" color="#ff4d4f" />
      <text class="error-text">{{errors.interestTags}}</text>
    </view>
  </view>

  <!-- éšç§è®¾ç½® -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="shield-o" size="32rpx" color="#1890ff" />
        <text class="title-text">éšç§è®¾ç½®</text>
      </view>
    </view>
    <view class="privacy-selector" bindtap="onShowPrivacyPicker">
      <view class="privacy-current">
        <text class="privacy-label">
          {{privacyLevel === 'public' ? 'å…¬å¼€' : privacyLevel === 'friends_only' ? 'å¥½å‹å¯è§' : 'ä»…äº¤æ¢å¯è§'}}
        </text>
        <text class="privacy-desc">
          {{privacyLevel === 'public' ? 'æ‰€æœ‰äººå¯è§' : privacyLevel === 'friends_only' ? 'ä»…å¥½å‹å¯è§' : 'äº¤æ¢åå¯è§'}}
        </text>
      </view>
      <van-icon name="arrow" size="32rpx" color="#999" />
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="bottom-actions safe-area-bottom">
    <view class="action-buttons">
      <button class="btn btn-secondary reset-btn" bindtap="onReset">
        é‡ç½®
      </button>
      <button 
        class="btn btn-primary submit-btn" 
        bindtap="onSubmit"
        loading="{{submitting}}"
        disabled="{{submitting}}"
      >
        {{submitting ? 'å‘å¸ƒä¸­...' : 'å‘å¸ƒå¡ç‰‡'}}
      </button>
    </view>
  </view>
</view>

<!-- éšç§é€‰æ‹©å¼¹çª— -->
<van-popup 
  show="{{showPrivacyPicker}}" 
  position="bottom"
  round
  bind:close="onHidePrivacyPicker"
>
  <view class="privacy-popup">
    <view class="popup-header">
      <text class="popup-title">é€‰æ‹©éšç§è®¾ç½®</text>
      <van-icon name="cross" size="40rpx" color="#999" bindtap="onHidePrivacyPicker" />
    </view>
    <view class="privacy-options">
      <view 
        wx:for="{{privacyOptions}}" 
        wx:key="value"
        class="privacy-option {{privacyLevel === item.value ? 'active' : ''}}"
        data-value="{{item.value}}"
        bindtap="onPrivacySelect"
      >
        <view class="option-info">
          <text class="option-label">{{item.label}}</text>
          <text class="option-desc">{{item.description}}</text>
        </view>
        <van-icon 
          wx:if="{{privacyLevel === item.value}}" 
          name="success" 
          size="40rpx" 
          color="#1890ff" 
        />
      </view>
    </view>
  </view>
</van-popup>
